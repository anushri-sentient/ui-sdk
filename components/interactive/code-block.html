<!-- Collapsible Code Snippet / Example Block -->
<div class="demo-section">
    <h2 class="demo-title">20. Collapsible Code Snippet / Example Block</h2>
    <ui-code-block 
        code="function greetUser(name) {\n  return `Hello, ${name}! Welcome to our platform.`;\n}\n\n// Usage\ngreetUser('World');"
        language="javascript"
        defaultOpen="true"
        theme="dark"
        copyable="true">
    </ui-code-block>
</div>

<style>
ui-code-block {
    display: block;
    margin: var(--size-3) 0;
}

ui-code-block .code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--size-2) var(--size-3);
    background: var(--surface-2);
    border: 1px solid var(--surface-3);
    border-bottom: none;
    border-radius: var(--radius-size) var(--radius-size) 0 0;
    font-size: 0.9rem;
    font-weight: 500;
}

ui-code-block .code-language {
    color: var(--text-2);
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
}

ui-code-block .code-controls {
    display: flex;
    gap: var(--size-2);
}

ui-code-block .code-toggle,
ui-code-block .code-copy {
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--size-1);
    border-radius: var(--radius-size);
    transition: background-color 0.2s var(--animation-smooth);
    color: var(--text-2);
}

ui-code-block .code-toggle:hover,
ui-code-block .code-copy:hover {
    background: var(--surface-3);
    color: var(--text-1);
}

ui-code-block .code-content {
    border: 1px solid var(--surface-3);
    border-radius: 0 0 var(--radius-size) var(--radius-size);
    overflow: hidden;
    transition: all 0.3s var(--animation-smooth);
}

ui-code-block .code-content.collapsed {
    max-height: 0;
    border-top: none;
}

ui-code-block .code-content.expanded {
    max-height: 500px;
}

ui-code-block .code-snippet {
    padding: var(--size-3);
    background: var(--surface-1);
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
    white-space: pre-wrap;
    word-break: break-word;
    overflow-x: auto;
}

ui-code-block.dark .code-snippet {
    background: #1e1e1e;
    color: #d4d4d4;
}

ui-code-block.light .code-snippet {
    background: #f8f9fa;
    color: #212529;
}

ui-code-block .copy-success {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--color-success);
    color: white;
    padding: var(--size-2) var(--size-3);
    border-radius: var(--radius-size);
    font-size: 0.8rem;
    opacity: 0;
    transition: opacity 0.2s var(--animation-smooth);
    pointer-events: none;
}

ui-code-block .copy-success.show {
    opacity: 1;
}
</style>

<script>
// Code Block Component Initialization
function initCodeBlocks() {
    document.querySelectorAll('ui-code-block').forEach(codeBlock => {
        const code = codeBlock.getAttribute('code');
        const language = codeBlock.getAttribute('language') || 'text';
        const defaultOpen = codeBlock.getAttribute('defaultOpen') === 'true';
        const theme = codeBlock.getAttribute('theme') || 'light';
        const copyable = codeBlock.getAttribute('copyable') === 'true';
        
        codeBlock.classList.add(theme);
        
        let codeHTML = '<div class="code-header">';
        codeHTML += `<span class="code-language">${language}</span>`;
        codeHTML += '<div class="code-controls">';
        
        if (copyable) {
            codeHTML += '<button class="code-copy" title="Copy code">ðŸ“‹</button>';
        }
        
        codeHTML += '<button class="code-toggle" title="Toggle code">ðŸ“„</button>';
        codeHTML += '</div></div>';
        
        codeHTML += '<div class="code-content">';
        codeHTML += `<pre class="code-snippet">${escapeHtml(code)}</pre>`;
        codeHTML += '</div>';
        
        if (copyable) {
            codeHTML += '<div class="copy-success">Copied!</div>';
        }
        
        codeBlock.innerHTML = codeHTML;
        
        const content = codeBlock.querySelector('.code-content');
        const toggle = codeBlock.querySelector('.code-toggle');
        const copy = codeBlock.querySelector('.code-copy');
        const copySuccess = codeBlock.querySelector('.copy-success');
        
        // Set initial state
        if (defaultOpen) {
            content.classList.add('expanded');
            toggle.textContent = 'ðŸ“„';
        } else {
            content.classList.add('collapsed');
            toggle.textContent = 'ðŸ“„';
        }
        
        // Toggle functionality
        toggle.addEventListener('click', () => {
            const isExpanded = content.classList.contains('expanded');
            if (isExpanded) {
                content.classList.remove('expanded');
                content.classList.add('collapsed');
                toggle.textContent = 'ðŸ“„';
            } else {
                content.classList.remove('collapsed');
                content.classList.add('expanded');
                toggle.textContent = 'ðŸ“„';
            }
        });
        
        // Copy functionality
        if (copy) {
            copy.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(code);
                    copySuccess.classList.add('show');
                    setTimeout(() => {
                        copySuccess.classList.remove('show');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy code:', err);
                }
            });
        }
    });
}

// Helper function to escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Initialize code blocks when DOM is loaded
document.addEventListener('DOMContentLoaded', initCodeBlocks);
</script>
