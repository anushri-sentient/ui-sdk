<!-- Advanced Audio/Video Player Component -->
<div class="demo-section">
    <h2 class="demo-title">27. Advanced Media Player</h2>
    <ui-media-player 
        type="video"
        src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4"
        poster="https://picsum.photos/800/450?random=1"
        title="Sample Video"
        description="A beautiful sample video for demonstration"
        autoplay="false"
        loop="false"
        muted="false"
        controls="true"
        playlist='[{"id":"1","title":"Sample Video 1","src":"https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4","poster":"https://picsum.photos/800/450?random=1","duration":"00:01:15"},{"id":"2","title":"Sample Video 2","src":"https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_2mb.mp4","poster":"https://picsum.photos/800/450?random=2","duration":"00:02:30"},{"id":"3","title":"Audio Track","src":"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav","poster":"https://picsum.photos/800/450?random=3","duration":"00:00:45","type":"audio"}]'
        show-playlist="true"
        theme="dark">
    </ui-media-player>
</div>

<style>
ui-media-player {
    display: block;
    background: var(--color-dark);
    border-radius: var(--radius-size);
    overflow: hidden;
    box-shadow: var(--shadow-large);
    margin: 1rem 0;
    position: relative;
}

ui-media-player .player-container {
    position: relative;
    width: 100%;
    background: #000;
}

ui-media-player .media-element {
    width: 100%;
    height: auto;
    display: block;
}

ui-media-player .player-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.3s var(--animation-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

ui-media-player .player-overlay.show {
    opacity: 1;
}

ui-media-player .play-button {
    width: 80px;
    height: 80px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 2rem;
    color: var(--color-primary);
    transition: all 0.3s var(--animation-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
}

ui-media-player .play-button:hover {
    background: white;
    transform: scale(1.1);
}

ui-media-player .controls-bar {
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    opacity: 0;
    transition: opacity 0.3s var(--animation-smooth);
}

ui-media-player .controls-bar.show {
    opacity: 1;
}

ui-media-player .progress-container {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
    cursor: pointer;
    margin-bottom: 1rem;
    position: relative;
}

ui-media-player .progress-bar {
    height: 100%;
    background: var(--color-primary);
    border-radius: 3px;
    position: relative;
    transition: width 0.1s linear;
}

ui-media-player .progress-handle {
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: var(--color-primary);
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.3s var(--animation-smooth);
}

ui-media-player .progress-container:hover .progress-handle {
    opacity: 1;
}

ui-media-player .controls-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

ui-media-player .controls-left {
    display: flex;
    align-items: center;
    gap: 1rem;
}

ui-media-player .controls-right {
    display: flex;
    align-items: center;
    gap: 1rem;
}

ui-media-player .control-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.25rem;
    transition: all 0.3s var(--animation-smooth);
    font-size: 1.1rem;
}

ui-media-player .control-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

ui-media-player .control-btn.active {
    color: var(--color-primary);
}

ui-media-player .time-display {
    color: white;
    font-size: 0.875rem;
    font-family: monospace;
}

ui-media-player .volume-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    position: relative;
}

ui-media-player .volume-slider {
    width: 60px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    cursor: pointer;
    position: relative;
}

ui-media-player .volume-level {
    height: 100%;
    background: white;
    border-radius: 2px;
    position: relative;
}

ui-media-player .volume-handle {
    position: absolute;
    right: -4px;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.3s var(--animation-smooth);
}

ui-media-player .volume-slider:hover .volume-handle {
    opacity: 1;
}

ui-media-player .fullscreen-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.25rem;
    transition: all 0.3s var(--animation-smooth);
    font-size: 1.1rem;
}

ui-media-player .fullscreen-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

ui-media-player .player-info {
    padding: 1rem;
    background: rgba(0, 0, 0, 0.8);
    color: white;
}

ui-media-player .media-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 0.5rem 0;
}

ui-media-player .media-description {
    font-size: 0.875rem;
    opacity: 0.8;
    margin: 0;
    line-height: 1.4;
}

ui-media-player .playlist-panel {
    background: rgba(0, 0, 0, 0.9);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    max-height: 300px;
    overflow-y: auto;
    display: none;
}

ui-media-player .playlist-panel.show {
    display: block;
}

ui-media-player .playlist-header {
    padding: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

ui-media-player .playlist-title {
    color: white;
    font-size: 1rem;
    font-weight: 600;
    margin: 0;
}

ui-media-player .close-playlist {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0.25rem;
}

ui-media-player .playlist-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s var(--animation-smooth);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

ui-media-player .playlist-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

ui-media-player .playlist-item.active {
    background: var(--color-primary);
    color: white;
}

ui-media-player .playlist-thumbnail {
    width: 60px;
    height: 40px;
    object-fit: cover;
    border-radius: 0.25rem;
    background: #333;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #666;
}

ui-media-player .playlist-info {
    flex: 1;
}

ui-media-player .playlist-item-title {
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0 0 0.25rem 0;
}

ui-media-player .playlist-item-duration {
    font-size: 0.75rem;
    opacity: 0.7;
    margin: 0;
}

ui-media-player .playlist-item-type {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

ui-media-player .loading-spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: none;
}

ui-media-player .loading-spinner.show {
    display: block;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

ui-media-player .error-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    text-align: center;
    display: none;
}

ui-media-player .error-message.show {
    display: block;
}

ui-media-player .error-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.7;
}

ui-media-player .error-text {
    font-size: 1rem;
    margin: 0;
}

/* Responsive Design */
@media (max-width: 768px) {
    ui-media-player .controls-row {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    ui-media-player .controls-left,
    ui-media-player .controls-right {
        justify-content: center;
    }
    
    ui-media-player .playlist-item {
        padding: 0.75rem;
    }
    
    ui-media-player .playlist-thumbnail {
        width: 50px;
        height: 35px;
    }
}
</style>

<script>
function initMediaPlayers() {
    document.querySelectorAll('ui-media-player').forEach(player => {
        const type = player.getAttribute('type') || 'video';
        const src = player.getAttribute('src') || '';
        const poster = player.getAttribute('poster') || '';
        const title = player.getAttribute('title') || '';
        const description = player.getAttribute('description') || '';
        const autoplay = player.getAttribute('autoplay') === 'true';
        const loop = player.getAttribute('loop') === 'true';
        const muted = player.getAttribute('muted') === 'true';
        const controls = player.getAttribute('controls') === 'true';
        const playlist = JSON.parse(player.getAttribute('playlist') || '[]');
        const showPlaylist = player.getAttribute('show-playlist') === 'true';
        const theme = player.getAttribute('theme') || 'dark';
        
        let currentTrackIndex = 0;
        let isPlaying = false;
        let isMuted = false;
        let currentVolume = 1;
        let isFullscreen = false;
        
        // Create player HTML
        let html = `
            <div class="player-container">
                <${type} class="media-element" ${poster ? `poster="${poster}"` : ''} ${autoplay ? 'autoplay' : ''} ${loop ? 'loop' : ''} ${muted ? 'muted' : ''} ${controls ? 'controls' : ''}>
                    <source src="${src}" type="${type === 'video' ? 'video/mp4' : 'audio/mpeg'}">
                    Your browser does not support the ${type} element.
                </${type}>
                
                <div class="loading-spinner" id="loadingSpinner"></div>
                
                <div class="error-message" id="errorMessage">
                    <div class="error-icon">⚠️</div>
                    <div class="error-text">Failed to load media</div>
                </div>
                
                <div class="player-overlay" id="playerOverlay">
                    <button class="play-button" id="playButton">▶</button>
                </div>
                
                <div class="controls-bar" id="controlsBar">
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-handle" id="progressHandle"></div>
                        </div>
                    </div>
                    
                    <div class="controls-row">
                        <div class="controls-left">
                            <button class="control-btn" id="playPauseBtn">▶</button>
                            <button class="control-btn" id="prevBtn">⏮</button>
                            <button class="control-btn" id="nextBtn">⏭</button>
                            <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
                        </div>
                        
                        <div class="controls-right">
                            <div class="volume-container">
                                <button class="control-btn" id="muteBtn">🔊</button>
                                <div class="volume-slider" id="volumeSlider">
                                    <div class="volume-level" id="volumeLevel">
                                        <div class="volume-handle" id="volumeHandle"></div>
                                    </div>
                                </div>
                            </div>
                            ${showPlaylist ? '<button class="control-btn" id="playlistBtn">📋</button>' : ''}
                            <button class="fullscreen-btn" id="fullscreenBtn">⛶</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="player-info">
                <h3 class="media-title" id="mediaTitle">${title}</h3>
                <p class="media-description" id="mediaDescription">${description}</p>
            </div>
            
            ${showPlaylist ? `
                <div class="playlist-panel" id="playlistPanel">
                    <div class="playlist-header">
                        <h4 class="playlist-title">Playlist</h4>
                        <button class="close-playlist" id="closePlaylist">×</button>
                    </div>
                    <div id="playlistItems"></div>
                </div>
            ` : ''}
        `;
        
        player.innerHTML = html;
        
        // Get elements
        const mediaElement = player.querySelector('.media-element');
        const playButton = player.querySelector('#playButton');
        const playPauseBtn = player.querySelector('#playPauseBtn');
        const prevBtn = player.querySelector('#prevBtn');
        const nextBtn = player.querySelector('#nextBtn');
        const muteBtn = player.querySelector('#muteBtn');
        const fullscreenBtn = player.querySelector('#fullscreenBtn');
        const playlistBtn = player.querySelector('#playlistBtn');
        const closePlaylist = player.querySelector('#closePlaylist');
        const progressContainer = player.querySelector('#progressContainer');
        const progressBar = player.querySelector('#progressBar');
        const volumeSlider = player.querySelector('#volumeSlider');
        const volumeLevel = player.querySelector('#volumeLevel');
        const timeDisplay = player.querySelector('#timeDisplay');
        const playerOverlay = player.querySelector('#playerOverlay');
        const controlsBar = player.querySelector('#controlsBar');
        const playlistPanel = player.querySelector('#playlistPanel');
        const playlistItems = player.querySelector('#playlistItems');
        const loadingSpinner = player.querySelector('#loadingSpinner');
        const errorMessage = player.querySelector('#errorMessage');
        
        // Initialize playlist
        if (playlist.length > 0) {
            renderPlaylist();
        }
        
        // Event listeners
        playButton.addEventListener('click', togglePlay);
        playPauseBtn.addEventListener('click', togglePlay);
        prevBtn.addEventListener('click', playPrevious);
        nextBtn.addEventListener('click', playNext);
        muteBtn.addEventListener('click', toggleMute);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        if (playlistBtn) playlistBtn.addEventListener('click', togglePlaylist);
        if (closePlaylist) closePlaylist.addEventListener('click', togglePlaylist);
        
        // Progress bar
        progressContainer.addEventListener('click', seek);
        progressContainer.addEventListener('mousemove', updateProgressHover);
        
        // Volume control
        volumeSlider.addEventListener('click', setVolume);
        
        // Media events
        mediaElement.addEventListener('loadstart', showLoading);
        mediaElement.addEventListener('canplay', hideLoading);
        mediaElement.addEventListener('error', showError);
        mediaElement.addEventListener('timeupdate', updateProgress);
        mediaElement.addEventListener('loadedmetadata', updateDuration);
        mediaElement.addEventListener('ended', onEnded);
        
        // Player overlay events
        playerOverlay.addEventListener('click', togglePlay);
        playerOverlay.addEventListener('mouseenter', showControls);
        playerOverlay.addEventListener('mouseleave', hideControls);
        
        // Global functions
        window.togglePlay = function() {
            if (isPlaying) {
                mediaElement.pause();
            } else {
                mediaElement.play();
            }
        };
        
        window.playPrevious = function() {
            if (playlist.length > 0) {
                currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
                loadTrack(currentTrackIndex);
            }
        };
        
        window.playNext = function() {
            if (playlist.length > 0) {
                currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                loadTrack(currentTrackIndex);
            }
        };
        
        window.toggleMute = function() {
            isMuted = !isMuted;
            mediaElement.muted = isMuted;
            muteBtn.textContent = isMuted ? '🔇' : '🔊';
        };
        
        window.toggleFullscreen = function() {
            if (!isFullscreen) {
                if (player.requestFullscreen) {
                    player.requestFullscreen();
                } else if (player.webkitRequestFullscreen) {
                    player.webkitRequestFullscreen();
                } else if (player.msRequestFullscreen) {
                    player.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        };
        
        window.togglePlaylist = function() {
            playlistPanel.classList.toggle('show');
        };
        
        function seek(e) {
            const rect = progressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            mediaElement.currentTime = percent * mediaElement.duration;
        }
        
        function setVolume(e) {
            const rect = volumeSlider.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            currentVolume = Math.max(0, Math.min(1, percent));
            mediaElement.volume = currentVolume;
            volumeLevel.style.width = (currentVolume * 100) + '%';
        }
        
        function updateProgress() {
            if (mediaElement.duration) {
                const percent = (mediaElement.currentTime / mediaElement.duration) * 100;
                progressBar.style.width = percent + '%';
                
                const currentTime = formatTime(mediaElement.currentTime);
                const duration = formatTime(mediaElement.duration);
                timeDisplay.textContent = `${currentTime} / ${duration}`;
            }
        }
        
        function updateDuration() {
            const duration = formatTime(mediaElement.duration);
            timeDisplay.textContent = `00:00 / ${duration}`;
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function showLoading() {
            loadingSpinner.classList.add('show');
            errorMessage.classList.remove('show');
        }
        
        function hideLoading() {
            loadingSpinner.classList.remove('show');
        }
        
        function showError() {
            loadingSpinner.classList.remove('show');
            errorMessage.classList.add('show');
        }
        
        function onEnded() {
            if (playlist.length > 0) {
                playNext();
            }
        }
        
        function showControls() {
            controlsBar.classList.add('show');
        }
        
        function hideControls() {
            if (isPlaying) {
                setTimeout(() => {
                    controlsBar.classList.remove('show');
                }, 3000);
            }
        }
        
        function loadTrack(index) {
            const track = playlist[index];
            mediaElement.src = track.src;
            if (track.poster) mediaElement.poster = track.poster;
            
            // Update info
            player.querySelector('#mediaTitle').textContent = track.title;
            player.querySelector('#mediaDescription').textContent = track.duration || '';
            
            // Update playlist active state
            player.querySelectorAll('.playlist-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
            
            // Auto play
            mediaElement.play();
        }
        
        function renderPlaylist() {
            playlistItems.innerHTML = playlist.map((track, index) => `
                <div class="playlist-item ${index === 0 ? 'active' : ''}" onclick="loadTrack(${index})">
                    <div class="playlist-thumbnail">
                        ${track.poster ? `<img src="${track.poster}" alt="${track.title}">` : 
                          track.type === 'audio' ? '🎵' : '🎬'}
                    </div>
                    <div class="playlist-info">
                        <div class="playlist-item-title">${track.title}</div>
                        <div class="playlist-item-duration">${track.duration}</div>
                    </div>
                    <div class="playlist-item-type">${track.type || 'video'}</div>
                </div>
            `).join('');
        }
        
        // Update play/pause button state
        mediaElement.addEventListener('play', () => {
            isPlaying = true;
            playButton.textContent = '⏸';
            playPauseBtn.textContent = '⏸';
            playerOverlay.classList.remove('show');
        });
        
        mediaElement.addEventListener('pause', () => {
            isPlaying = false;
            playButton.textContent = '▶';
            playPauseBtn.textContent = '▶';
            playerOverlay.classList.add('show');
        });
        
        // Fullscreen change event
        document.addEventListener('fullscreenchange', () => {
            isFullscreen = !!document.fullscreenElement;
        });
    });
}

document.addEventListener('DOMContentLoaded', initMediaPlayers);
</script>
